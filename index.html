<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <title>Document</title>

    <style>
        .container{
            width: 100%;
        }
        .table{
            border: 5px solid #a3c5e9;
        }
        .table th{
            background-color: #a3c5e9
        }
        #myDataTable th{
            background-color: #bddae5
        }
        .table td{
            background-color: #bddae5;
            font-family: system-ui;
            font-weight: 600;
            font-size: 17px;
        }
        thead th{
            top: 0;
            position: sticky;
        }
        @media (max-width: 991.98px) { 
            .container{
                margin: 0;
            }
         }
    </style>

</head>
<body>
<section class="container">
    <div class="text-end p-4">
        <div class="text-end p-3"><button class="btn btn-primary" onclick="addAndEditDetails(null,'add')">+ Add</button>
        </div>
    </div>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Sr.No.</th>
                <th scope="col">FirstName</th>
                <th scope="col">LastName</th>
                <th scope="col">Role</th>
                <th scope="col">Age</th>
                <th scope="col">Department</th>
                <th scope="col">Contact</th>
                <th scope="col">Email</th>
                <th scope="col">Locality</th>
                <th scope="col">Update</th>
                <th scope="col">Delete</th>
            </tr>
        </thead>
        <tbody id="myDataTable"> </tbody>
    </table>
</section>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form class="modal-content" id="myForm" onsubmit="return detailsSubmitFun(event)">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span id="modalTitle">Add</span> Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="myFormContainer">
                        <div class="mb-1">
                            <label for="firstNameInputContrl" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstNameInputContrl"
                                placeholder="Write here...">
                                <span id="fnamespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="lastNameInputContrl" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastNameInputContrl"
                                placeholder="Write here...">
                                <span id="lnamespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="roleInputContrl" class="form-label">Role</label>
                            <input type="text" class="form-control" id="roleInputContrl"
                                placeholder="Write here...">
                                <span id="rolespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="ageInputContrl" class="form-label">Age</label>
                            <input type="number" class="form-control" id="ageInputContrl" placeholder="Write here...">
                            <span id="agespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="departmentInputContrl" class="form-label">Department</label>
                            <input type="text" class="form-control" id="departmentInputContrl" placeholder="Write here...">
                            <span id="departmntspan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="contactInputContrl" class="form-label">Contact</label>
                            <input type="number" class="form-control" id="contactInputContrl"
                                placeholder="Write here...">
                                <span id="contactspan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="emailInputContrl" class="form-label">Email ID</label>
                            <input type="email" class="form-control" id="emailInputContrl" placeholder="Write here...">
                            <span id="emailspan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="localityInputContrl" class="form-label">Locality</label>
                            <input type="text" class="form-control" id="localityInputContrl" placeholder="Write here...">
                            <span id="localityspan"></span>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>

    <h2 id="errorMsg">No data found</h2>

<script src="js/bootstrap.bundle.min.js"></script>

<script>
    var myModal = new bootstrap.Modal(document.getElementById('exampleModal'), {
            keyboard: false
        });


    function readTextFile(file, callback) {
        var rawFile = new XMLHttpRequest();
        rawFile.overrideMimeType("application/json");
        rawFile.open("GET", file, true);
        rawFile.onreadystatechange = function() {
            console.log("rawFile", rawFile);
            if (rawFile.readyState === 4 && rawFile.status == "200") {
                callback(rawFile.responseText);
            } else {
                if (rawFile.readyState === 0) {
                    alert("Error something went wrong!");
                }
            }
        }
        rawFile.send(null);
    }

    usage:
    var globalData;
    var editModeIs = false;
    var selectedObj = {};
     var getDataFromLocalStrg = localStorage.getItem("myStdntInfoData");
     console.log("getDataFromLocalStrg", getDataFromLocalStrg);
         if (getDataFromLocalStrg) {
             globalData = JSON.parse(getDataFromLocalStrg);
             updateData(globalData);
        } else {
            readTextFile("/JsonData.json", function (text) {
                var data = JSON.parse(text);
                console.log("data", data);
                globalData = data;
                updateData(data);
            });
        }

    function myDeleteFun(data) {
        console.log("data", data);
        for (let i = 0; i < globalData.length; i++) {
            const element = globalData[i];
            if (element.id == data.id) {
                globalData.splice(i, 1);
                break;
            }
        }
        updateData(globalData);
        console.log("globalData", globalData);
    }

    function updateData(data) {
        console.log("data", data);
        document.getElementById("myDataTable").innerHTML = "";
        for (let index = 0; index < data.length; index++) {
            const element = data[index];

            var myRow = document.createElement("TR");
            var myTh = document.createElement("TH");
            myTh.innerHTML = index + 1;

            var myfNameTD = document.createElement("TD");
            myfNameTD.innerHTML = element.firstName;

            var mylNameTD = document.createElement("TD");
            mylNameTD.innerHTML = element.lastName;

            var myRoleTD = document.createElement("TD");
            myRoleTD.innerHTML = element.role;

            var myAgeTD = document.createElement("TD");
            myAgeTD.innerHTML = element.age;

            var myDepartmentTD = document.createElement("TD");
            myDepartmentTD.innerHTML = element.department;

            var myNumberTD = document.createElement("TD");
            myNumberTD.innerHTML = element.contact;

            var myEmailTD = document.createElement("TD");
            myEmailTD.innerHTML = element.email;

            var myLocalityTD = document.createElement("TD");
            myLocalityTD.innerHTML = element.locality;

            var myEditTD = document.createElement("TD");
            var editBtn = "<button class='btn btn-primary' onclick='addAndEditDetails(" + JSON.stringify(element) +
                    ",\"edit\")'>Edit</button>";
                myEditTD.innerHTML = editBtn;

            var myDeleteTD = document.createElement("TD");
            var deleteBtn = "<button class='btn btn-danger' onclick='myDeleteFun(" + JSON.stringify(element) +
                ")'>Delete</button>";
            myDeleteTD.innerHTML = deleteBtn;

            myRow.append(myTh, myfNameTD, mylNameTD, myRoleTD, myAgeTD, myDepartmentTD, myNumberTD, myEmailTD, myLocalityTD, myEditTD, myDeleteTD);

            document.getElementById("myDataTable").append(myRow);
        }
        localStorage.setItem("myStdntInfoData", JSON.stringify(data));
            checkData(); 
    }

        function addAndEditDetails(getObj, secParam) {
            console.log("getObj", getObj);
            console.log("secParam", secParam);
            myModal.show();
            if (secParam == "add") {
                document.getElementById("myForm").reset();
                document.getElementById("modalTitle").innerHTML = "Add";
                editModeIs = false;
            } else {
                document.getElementById("modalTitle").innerHTML = "Edit";
                document.getElementById("firstNameInputContrl").value = getObj.firstName;
                document.getElementById("lastNameInputContrl").value = getObj.lastName;
                document.getElementById("roleInputContrl").value = getObj.role;
                document.getElementById("ageInputContrl").value = getObj.age;
                document.getElementById("departmentInputContrl").value = getObj.department;
                document.getElementById("contactInputContrl").value = getObj.contact;
                document.getElementById("emailInputContrl").value = getObj.email;
                document.getElementById("localityInputContrl").value = getObj.locality;
                selectedObj = getObj;
                editModeIs = true;
            }
        }

        function detailsSubmitFun(event) {
            event.preventDefault();
            var fnameInputVal = document.getElementById("firstNameInputContrl").value;
            var lnameInputVal = document.getElementById("lastNameInputContrl").value;
            var roleInputVal = document.getElementById("roleInputContrl").value;
            var ageInputVal = document.getElementById("ageInputContrl").value;
            var departmentInputVal = document.getElementById("departmentInputContrl").value;
            var contactInputVal = document.getElementById("contactInputContrl").value;
            var emailInputVal = document.getElementById("emailInputContrl").value;
            var localityInputVal = document.getElementById("localityInputContrl").value;

            if (editModeIs) {
                for (let index = 0; index < globalData.length; index++) {
                    if (globalData[index].id == selectedObj.id) {
                        globalData[index].firstName = fnameInputVal;
                        globalData[index].lastName = lnameInputVal;
                        globalData[index].role = roleInputVal;
                        globalData[index].age = ageInputVal;
                        globalData[index].department = departmentInputVal;
                        globalData[index].contact = contactInputVal;
                        globalData[index].email = emailInputVal;
                        globalData[index].locality = localityInputVal;
                    }
                }
            } else {
                var uniqueId = new Date().getTime();
                var newObj = {
                    "id": uniqueId,
                    "firstName": fnameInputVal,
                    "lastName": lnameInputVal,
                    "role": roleInputVal,
                    "age": ageInputVal,
                    "department": departmentInputVal,
                    "contact": contactInputVal,
                    "email": emailInputVal,
                    "locality": localityInputVal
                };
                globalData.push(newObj);
            }

            updateData(globalData);
            document.getElementById("myForm").reset();
            myModal.hide();
        }

        function checkData() {
            if (globalData.length > 0) {
                document.getElementById("errorMsg").style.display = "none";
            } else {
                document.getElementById("errorMsg").style.display = "block";
            }
        }
</script>
</body>
</html>