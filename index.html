<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/all.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <title>Document</title>

    <style>
        .head {
            background: linear-gradient(170deg, rgba(202,235,255,1) 15%, rgba(0,212,255,1) 50%, rgba(202,235,255,1) 85%);
            border: 20px solid #76d0e9;
            margin: 0px -15px 0px 4px;
            align-items: center;
        }
        .crud{
            font-size: 45px;
            font-weight: 600;
        }
        .table{
            border: 5px solid #76d0e9;        
        }
        .table th{
            background-color: #76d0e9;
        }
        #myDataTable th{
            background-color: #b1e2ef;
            font-weight: 900;
        }
        .table td{
            background-color: #b1e2ef;
            font-weight: 600;
            font-size: 17px;
            font-family: -webkit-pictograph;
        }
        thead th{
            top: 0;
            position: sticky;
            font-size: 19px;
        }
        .error{
            text-align: center;
        }
        #errorMsg{
            color: red;
            font-size: 40px;
            font-weight: 600;
        }
        span{
            color: red;
            font-size: 17px;
            font-weight: 600;
        }
        #modalTitle{
            color: black;
        }
        @media (max-width: 991.98px) { 
            .container{
                margin: 0;
            }
         }
    </style>

</head>
<body>
<section class="container-fluid ">
    <div class="head row ">
    <div class="crud col-sm-6">CRUD DATABASE SYSTEM</div>
      <div class="col-sm-6"> 
        <div class="text-end p-4"><button class="btn btn-primary" onclick="addAndEditDetails(null,'add')">+ Add</button>
        </div>
      </div>
    </div>
    <table class="table mx-1">
        <thead>
            <tr>
                <th scope="col">Sr.No.</th>
                <th scope="col">FirstName</th>
                <th scope="col">LastName</th>
                <th scope="col">Role</th>
                <th scope="col">Age</th>
                <th scope="col">Department</th>
                <th scope="col">Hobbies</th>
                <th scope="col">Date</th>
                <th scope="col">Contact</th>
                <th scope="col">Email</th>
                <th scope="col">Locality</th>
                <th scope="col">Update</th>
                <th scope="col">Delete</th>
            </tr>
        </thead>
        <tbody id="myDataTable"> </tbody>
    </table>
</section>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form class="modal-content" id="myForm" onsubmit="return detailsSubmitFun(event)">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel"><span id="modalTitle">Add</span> Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="myFormContainer">
                        <div class="mb-1">
                            <label for="firstNameInputContrl" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstNameInputContrl"
                                placeholder="Write here...">
                                <span id="fnamespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="lastNameInputContrl" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastNameInputContrl"
                                placeholder="Write here...">
                                <span id="lnamespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="roleInputContrl" class="form-label">Role</label>
                            <input type="text" class="form-control" id="roleInputContrl"
                                placeholder="Write here...">
                                <span id="rolespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="ageInputContrl" class="form-label">Age</label>
                            <input type="number" class="form-control" id="ageInputContrl" placeholder="Write here...">
                            <span id="agespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="departmentInputContrl" class="form-label">Department</label>
                            <input type="text" class="form-control" id="departmentInputContrl" placeholder="Write here...">
                            <span id="departmentspan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="hobbiesInputContrl" class="form-label">Hobbies</label>
                            <input type="text" class="form-control" id="hobbiesInputContrl" placeholder="Write here...">
                            <span id="hobbiesspan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="dateInputContrl" class="form-label">Date</label>
                            <input type="date" class="form-control" id="dateInputContrl" placeholder="Write here...">
                            <span id="datespan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="contactInputContrl" class="form-label">Contact</label>
                            <input type="number" class="form-control" id="contactInputContrl" placeholder="Write here..."
                            oninput="this.value = this.value.replace(/[^0-9,]/g, '').replace(/(\..*)\./g, '$1');">
                                <span id="contactspan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="emailInputContrl" class="form-label">Email ID</label>
                            <input type="email" class="form-control" id="emailInputContrl" placeholder="Write here...">
                            <span id="emailspan"></span>
                        </div>
                        <div class="mb-1">
                            <label for="localityInputContrl" class="form-label">Locality</label>
                            <input type="text" class="form-control" id="localityInputContrl" placeholder="Write here...">
                            <span id="localityspan"></span>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- delete modal box -->
<!-- Modal -->
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Delete Details</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
       Are you sure?
       Do you want to delete this person's details
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Yes</button>
        <button type="button" class="btn btn-primary">No</button>
      </div>
    </div>
  </div>
</div>
    

    <div class="error">
     <h2 id="errorMsg">No data found</h2>
    </div>

<script src="js/bootstrap.bundle.min.js"></script>

<script>
    var myModal = new bootstrap.Modal(document.getElementById('exampleModal'), {
            keyboard: false
        });

    var myDeleteModal = new bootstrap.Modal(document.getElementById('exampleModalLong'), {
            keyboard: false
        });
        
    


    function readTextFile(file, callback) {
        var rawFile = new XMLHttpRequest();
        rawFile.overrideMimeType("application/json");
        rawFile.open("GET", file, true);
        rawFile.onreadystatechange = function() {
            console.log("rawFile", rawFile);
            if (rawFile.readyState === 4 && rawFile.status == "200") {
                callback(rawFile.responseText);
            } else {
                if (rawFile.readyState === 0) {
                    alert("Error something went wrong!");
                }
            }
        }
        rawFile.send(null);
    }

    usage:
    var globalData;
    var editModeIs = false;
    var selectedObj = {};
     var getDataFromLocalStrg = localStorage.getItem("myStdntInfoData");
     console.log("getDataFromLocalStrg", getDataFromLocalStrg);
        //  if (getDataFromLocalStrg) {
        //      globalData = JSON.parse(getDataFromLocalStrg);
        //      updateData(globalData);
        // } else {
            readTextFile("JsonData.json", function (text) {
                var data = JSON.parse(text);
                console.log("data", data);
                globalData = data;
                updateData(data);
            });
        // }

    function myDeleteFun(data) {
        myDeleteModal.show()
        console.log("data", data);
        
        for (let i = 0; i < globalData.length; i++) {
            const element = globalData[i];
            if (element.id == data.id) {
                globalData.splice(i, 1);
                break;
            }
        
        }
        console.log("myDeleteFun",myDeleteFun)
        updateData(globalData);
        console.log("globalData", globalData);
    }

    function updateData(data) {
        console.log("data", data);
        document.getElementById("myDataTable").innerHTML = "";
        for (let index = 0; index < data.length; index++) {
            const element = data[index];

            var myRow = document.createElement("TR");
            var myTh = document.createElement("TH");
            myTh.innerHTML = index + 1;

            var myfNameTD = document.createElement("TD");
            myfNameTD.innerHTML = element.firstName;

            var mylNameTD = document.createElement("TD");
            mylNameTD.innerHTML = element.lastName;

            var myRoleTD = document.createElement("TD");
            myRoleTD.innerHTML = element.role;

            var myAgeTD = document.createElement("TD");
            myAgeTD.innerHTML = element.age;

            var myDepartmentTD = document.createElement("TD");
            myDepartmentTD.innerHTML = element.department;

            var myHobbiesTD = document.createElement("TD");
            myHobbiesTD.innerHTML = element.hobbies;

            var myDateTD = document.createElement("TD");
            myDateTD.innerHTML = element.date;

            var myNumberTD = document.createElement("TD");
            myNumberTD.innerHTML = element.contact;

            var myEmailTD = document.createElement("TD");
            myEmailTD.innerHTML = element.email;

            var myLocalityTD = document.createElement("TD");
            myLocalityTD.innerHTML = element.locality;

            var myEditTD = document.createElement("TD");
            var editBtn = "<button class='btn btn-primary' onclick='addAndEditDetails(" + JSON.stringify(element) +
                    ",\"edit\")'>Edit</button>";
                myEditTD.innerHTML = editBtn;

            var myDeleteTD = document.createElement("TD");
            var deleteBtn = "<button class='btn btn-danger' onclick='myDeleteFun(" + JSON.stringify(element) +
                ")'>Delete</button>";
            myDeleteTD.innerHTML = deleteBtn;

            myRow.append(myTh, myfNameTD, mylNameTD, myRoleTD, myAgeTD, myDepartmentTD, myHobbiesTD, myDateTD, myNumberTD, myEmailTD, myLocalityTD, myEditTD, myDeleteTD);

            document.getElementById("myDataTable").append(myRow);
        }
        localStorage.setItem("myStdntInfoData", JSON.stringify(data));
            checkData(); 
    }

        function addAndEditDetails(getObj, secParam) {
            console.log("getObj", getObj);
            console.log("secParam", secParam);
            myModal.show();
            if (secParam == "add") {
                document.getElementById("myForm").reset();
                document.getElementById("modalTitle").innerHTML = "Add";
                editModeIs = false;
            } else {
                document.getElementById("modalTitle").innerHTML = "Edit";
                document.getElementById("firstNameInputContrl").value = getObj.firstName;
                document.getElementById("lastNameInputContrl").value = getObj.lastName;
                document.getElementById("roleInputContrl").value = getObj.role;
                document.getElementById("ageInputContrl").value = getObj.age;
                document.getElementById("departmentInputContrl").value = getObj.department;
                document.getElementById("hobbiesInputContrl").value = getObj.hobbies;
                document.getElementById("dateInputContrl").value = getObj.date;
                document.getElementById("contactInputContrl").value = getObj.contact;
                document.getElementById("emailInputContrl").value = getObj.email;
                document.getElementById("localityInputContrl").value = getObj.locality;
                selectedObj = getObj;
                editModeIs = true;
            }
        }
        
        //function of delete

        function detailsSubmitFun(event) {
            event.preventDefault();
            var fnameInputVal = document.getElementById("firstNameInputContrl").value;
            var lnameInputVal = document.getElementById("lastNameInputContrl").value;
            var roleInputVal = document.getElementById("roleInputContrl").value;
            var ageInputVal = document.getElementById("ageInputContrl").value;
            var departmentInputVal = document.getElementById("departmentInputContrl").value;
            var hobbiesInputVal = document.getElementById("hobbiesInputContrl").value;
            var dateInputVal = document.getElementById("dateInputContrl").value;
            var contactInputVal = document.getElementById("contactInputContrl").value;
            var emailInputVal = document.getElementById("emailInputContrl").value;
            var localityInputVal = document.getElementById("localityInputContrl").value;


            var firstname = document.getElementById("firstNameInputContrl").value;
            var lastname = document.getElementById("lastNameInputContrl").value;
            var role = document.getElementById("roleInputContrl").value;
            var age = document.getElementById("ageInputContrl").value;
            var department = document.getElementById("departmentInputContrl").value;
            var hobbies = document.getElementById("hobbiesInputContrl").value;
            var date = document.getElementById("dateInputContrl").value;
            var contact = document.getElementById("contactInputContrl").value;
            var email = document.getElementById("emailInputContrl").value;
            var locality = document.getElementById("localityInputContrl").value;

            var name_regex = /^[a-zA-Z^S]{2,30}$/;
            var role_regex = /^[a-zA-Z^S]{2,10}$/;
            var age_regex = /^[0-9^S]{2}$/;
            var department_regex = /[A-Z]{2,10}/;
            var hobbies_regex = /^[a-zA-Z^S]{2,16}$/;
            var contact_regex = /^[6789][0-9]{9}/;
            var emailtest = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
            var locality_regex = /^[a-zA-Z]{2,16}$/;


        if (firstname && lastname && role  && age && department && hobbies && contact && email && locality) {
        let ifAllInputHaveValidVal = true;
        if (name_regex.test(firstname)) {
          document.getElementById("fnamespan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("fnamespan").innerHTML = "firstname is Invalid";
        }
        
        if (name_regex.test(lastname)) {
          document.getElementById("lnamespan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("lnamespan").innerHTML = "lastname is Invalid";
        }

        if (role_regex.test(role)) {
          document.getElementById("rolespan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("rolespan").innerHTML = "role is Invalid";
        }

        if (age_regex.test(age)) {
          document.getElementById("agespan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("agespan").innerHTML = "age is Invalid";
        }

        if (department_regex.test(department)) {
          document.getElementById("departmentspan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("departmentspan").innerHTML = "department is Invalid";
        }

        if (hobbies_regex.test(hobbies)) {
          document.getElementById("hobbiesspan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("hobbiesspan").innerHTML = "hobbies is Invalid";
        }

        if (emailtest.test(email)) {
          document.getElementById("emailspan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("emailspan").innerHTML = "email is Invalid";
        }

        if (contact_regex.test(contact)) {
          document.getElementById("contactspan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("contactspan").innerHTML = "Mobile number is Invalid";
        }

        if (emailtest.test(email)) {
          document.getElementById("emailspan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("emailspan").innerHTML = "email is Invalid";
        }

        if (locality_regex.test(locality)) {
          document.getElementById("localityspan").innerHTML = "";
        } else {
          ifAllInputHaveValidVal = false;
          document.getElementById("localityspan").innerHTML = "locality is Invalid";
        }
    }else{
        
            if (!firstname) {
             document.getElementById("fnamespan").innerHTML = "please fill the above requirements";
            }
            
            if (!lastname) {
             document.getElementById("lnamespan").innerHTML = "please fill the above requirements";
            }

            if (!role) {
             document.getElementById("rolespan").innerHTML = "please fill the above requirements";
            }

            if (!age) {
             document.getElementById("agespan").innerHTML = "please fill the above requirements";
            }

            if (!department) {
             document.getElementById("departmentspan").innerHTML = "please fill the above requirements";
            }

            if (!hobbies) {
             document.getElementById("hobbiesspan").innerHTML = "please fill the above requirements";
            }

            if (!contact) {
             document.getElementById("contactspan").innerHTML = "please fill the above requirements";
            }

            if (!email) {
             document.getElementById("emailspan").innerHTML = "please fill the above requirements";
            }

            if (!locality) {
             document.getElementById("localityspan").innerHTML = "please fill the above requirements";
            }
        } console.log("ifAllInputHaveValidVal",ifAllInputHaveValidVal)
    }


            if (editModeIs) {
                for (let index = 0; index < globalData.length; index++) {
                    if (globalData[index].id == selectedObj.id) {
                        globalData[index].firstName = fnameInputVal;
                        globalData[index].lastName = lnameInputVal;
                        globalData[index].role = roleInputVal;
                        globalData[index].age = ageInputVal;
                        globalData[index].department = departmentInputVal;
                        globalData[index].hobbies = hobbiesInputVal;
                        globalData[index].date = dateInputVal;
                        globalData[index].contact = contactInputVal;
                        globalData[index].email = emailInputVal;
                        globalData[index].locality = localityInputVal;
                    }
                }
            } else {
                var uniqueId = new Date().getTime();
                var newObj = {
                    "id": uniqueId,
                    "firstName": fnameInputVal,
                    "lastName": lnameInputVal,
                    "role": roleInputVal,
                    "age": ageInputVal,
                    "department": departmentInputVal,
                    "hobbies": hobbiesInputVal,
                    "date": dateInputVal,
                    "contact": contactInputVal,
                    "email": emailInputVal,
                    "locality": localityInputVal
                };
                globalData.push(newObj);
            }

            updateData(globalData);
            document.getElementById("myForm").reset();
            myModal.hide();

            // function myDeleteFun(){
                

            //     console.log("myDeleteFun", myDeleteFun);
            //     function Yes(){
            //         element.id
            //     }
            // }
        

        function checkData() {
            if (globalData.length > 0) {
                document.getElementById("errorMsg").style.display = "none";
            } else {
                document.getElementById("errorMsg").style.display = "block";
            }
        }
</script>
</body>
</html>